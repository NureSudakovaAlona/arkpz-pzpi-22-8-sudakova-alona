# FocusLearn

FocusLearn — це програмна система, яка підтримує навчання користувачів, автоматизуючи процес концентрації через інтеграцію з IoT-пристроями. Система надає функції адміністрування, обробки статистики, роботи IoT-клієнта та взаємодії з сервером через протокол MQTT.

## Особливості

- **Функції адміністрування**:
  - Зміна статусу користувача (Active/Inactive).
  - Бекап та відновлення бази даних (схема та дані).
  - Експорт/імпорт даних у форматі JSON.

- **IoT-клієнт**:
  - Інтеграція через протокол MQTT.
  - Управління концентраційними сесіями за допомогою вібрації та звуку.
  - Збереження даних про сесії у базу даних.

- **Бізнес-логіка**:
  - Розрахунок статистики продуктивності користувача.
  - Підрахунок ефективності методик концентрації.
  - Оновлення статистики автоматично на сервері.

---

## Вимоги

### Серверна частина
1. **Програмне забезпечення**:
   - .NET SDK 7.0 або новіша версія.
   - SQL Server для зберігання бази даних.

2. **Додаткові бібліотеки**:
   - `Microsoft.EntityFrameworkCore`.
   - `Microsoft.AspNetCore.Authentication.Google` для авторизації.
   - `Microsoft.Data.SqlClient`.

3. **Налаштування бази даних**:
   - У файлі `appsettings.json` має бути вказаний `DefaultConnection` для SQL Server:
     ```json
     {
       "ConnectionStrings": {
         "DefaultConnection": "Server=localhost;Database=FocusLearnDB;Trusted_Connection=True;MultipleActiveResultSets=true"
       }
     }
     ```

### IoT-клієнт
1. **Платформа IoT**:
   - ESP32.
   - Онлайн-брокер MQTT (наприклад, [EMQX](https://www.emqx.com/en/mqtt/public-mqtt5-broker)).

2. **Додаткові компоненти**:
   - OLED-дисплей SSD1306.
   - Кнопка.
   - Вібромотор або звуковий модуль.

3. **Arduino IDE**:
   - Встановлені бібліотеки:
     - `Adafruit GFX Library`.
     - `Adafruit SSD1306`.
     - `PubSubClient`.
     - `ArduinoJson`.

---

## Інструкція з розгортання

### 1. Розгортання серверної частини

1. Встановіть .NET SDK 7.0.
2. Налаштуйте `appsettings.json` із правильним підключенням до бази даних.
3. Виконайте міграції:
   ```bash
   dotnet ef database update
   ```
4. Запустіть сервер:
   ```bash
   dotnet run
   ```

### 2. Налаштування IoT-клієнта

1. Перейдіть на [Wokwi](https://wokwi.com/) або використовуйте фізичний пристрій ESP32.
2. Підключіть компоненти:
   - OLED-дисплей:
     - `SCL` -> `D21`, `SDA` -> `D22`.
   - Кнопка:
     - `BTN1` -> `D25`.
   - Вібромотор або дзвінок:
     - `BZ1` -> `D32`.
3. Завантажте код IoT у ESP32 через Arduino IDE.

4. Налаштуйте WiFi та MQTT:
   - Задайте `ssid` і `password` для WiFi.
   - Вкажіть `mqttServer` у коді:
     ```cpp
     const char* mqttServer = "broker.emqx.io";
     ```

---

## Основні API-ендпоінти

### Адміністрування
- **POST** `/api/Admin/change-user-status`: Змінити статус користувача.
- **POST** `/api/Admin/backup-database`: Створити бекап бази даних.
- **POST** `/api/Admin/export-data`: Експортувати дані таблиць.

### Бізнес-логіка
- **GET** `/api/BusinessLogic/user-statistics`: Отримати статистику користувача.
- **POST** `/api/BusinessLogic/update-method-statistics`: Оновити статистику методик.
- **GET** `/api/BusinessLogic/most-effective-method`: Визначити найефективнішу методику.

### IoT-клієнт
- **GET** `/api/IoT/get-method/{id}`: Отримати методику за ID.
- **POST** `/api/IoT/add-session`: Додати сесію IoT.

---

## Демонстрація роботи

1. **Функції адміністрування**:
   - Зміна статусу користувача.
   - Автоматичний бекап бази даних при запуску.
2. **IoT-клієнт**:
   - Отримання методики з API.
   - Відлік сесій концентрації на OLED-дисплеї.
   - Передача даних про сесії на сервер через MQTT.
3. **Бізнес-логіка**:
   - Автоматичне оновлення статистики продуктивності.

---
